import WebSocket from "ws";

const WEB_SOCKETS_URL =
  "wss://0a72003004a59390c0dab15f005200a8.web-security-academy.net/chat";

const ws = new WebSocket(WEB_SOCKETS_URL, undefined, {
  headers: {
    // "X-Forwarded-For": "192.1.1.1",
    "accept-language": "en-US,en;q=0.9,es;q=0.8",
    "cache-control": "no-cache",
    pragma: "no-cache",
    "sec-websocket-extensions": "permessage-deflate; client_max_window_bits",
    "sec-websocket-key": "RS9CeuhKfpqPwBy7XWaR2g==",
    "sec-websocket-version": "13",
  },
});

ws.on("open", async function open() {
  console.log("hi");
  await sleep(3000);
  ws.send(`hello`);
  console.log("hi2");
  //   ws.send("hello");
});

ws.on("connect", function (connection: any) {
  console.log("Connection established!");

  connection.on("error", function (error: any) {
    console.log("Connection error: " + error.toString());
  });

  connection.on("close", function () {
    console.log("Connection closed!");
  });

  connection.on("message", function (message: any) {
    console.log("Current time on server is: '" + message.data + "'");
  });
});

ws.on("connectFailed", function (error) {
  console.log("Connect Error: " + error.toString());
});

ws.on("message", function message(data) {
  console.log("received: %s", data);
});

// console.log(ws);

function sleep(ms: any) {
  return new Promise((resolve) => setTimeout(resolve, ms));
}
